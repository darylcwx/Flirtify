<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Flirtify Home</title>

        <!-- FAVICON -->
        <link rel="icon" type="image/x-icon" href="../images/flirtify-favicon.png">

        <!-- CSS Style -->
        <link rel = 'stylesheet' href = '../style/style.css'>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

        <!-- FONTAWESOME -->
        <script src="https://kit.fontawesome.com/fe33c26b25.js" crossorigin="anonymous"></script>

        <!-- JavaScript -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <!-- VueJS -->
        <script src="https://unpkg.com/vue@next"></script>

        <!-- AXIOS -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    </head>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">
                <img src="https://github.com/darylcwx/Flirtify/blob/main/images/flirtify-logo.png?raw=true" alt="Flirtify Logo" width="40" height="24" class="d-inline-block align-text-top">
                <!-- <span class="fs-4">Flirtify</span> -->
              </a>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="home.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="matches.html">Matches</a>
              </li>
              <li class="nav-item dropdown account-details" style="position: absolute !important; right: 50px;">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Account
                </a>
                <ul class="dropdown-menu me-4">
                  <li><a class="dropdown-item" href="#">Login / Signup</a></li>
                  <li><a class="dropdown-item" href="#">Logout</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
    </nav>

<body>
    <div id="app" class="container-fluid">

        <!-- IF NO MATCHES -->
        <div class="text-center mt-5" v-if="matchesResult.length == 0">
            <h1>You have no matches <b>YET</b>!</h1>
            <form action="../templates/home.html">
                <button type="submit" class="btn btn-danger mt-4">Swipe more!</button>
            </form>
        </div>

        <!-- IF MATCHES -->
        <div class="text-center mt-5" v-else>
            <h1>Here are your matches!</h1>

        </div>
        <table class="d-flex justify-content-center mt-5">
            <tr>
                <th></th>
                <th>Name</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
            <tr v-for="item in matchesResult">
                <td><img id="profilePic" src="../images/flirtify-logo.png" alt="Profile Picture"></td>
                <!-- <td>Username</td> -->
                <td>{{ item.user_id2 }}</td>
                <td>{{ item.age }}</td>
                <td>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        <i class="fa-sharp fa-solid fa-ellipsis-vertical fa-2xl text-center" style="color: #515967;"></i>
                    </button>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                            ...
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary">Save changes</button>
                            <!-- <button type="button" class="btn btn-primary">Date Ideas</button> -->
                            <!-- <button type="button" class="btn btn-primary">Report</button> -->
                            </div>
                        </div>
                        </div>
                    </div>
                    
                
                </td>
                <td>
                    <!-- Tag match_id to each button -->
                    <button type="button" class="btn btn-danger">Message <i class="fa-regular fa-message"></i></button>
                </td>
            </tr>
        </table>
    </div>


<script>

    // var user_id = session['user_id'];

    //for testing
    var user_id = "849412270214119425";

    const app = Vue.createApp(
        {
            data(){

                // Matches Data
                // matchesResult is the array that will be used to display the matches using match microservice
                // matchesInfo is the array that will be used to store the information of the matches that accesses user.py microservice

                return {
                    matchesResult : [],
                    matchesInfo: {}
                }
            },

            methods : {
                getMatches() {
                    axios.get("http://localhost:5002/successful_match/849412270214119425", 
                        {
                          headers: {
                                "Access-Control-Allow-Origin": '*'
                            }  
                        })
                    // fetch(
                    // //   "http://localhost:5002/successful_match/" + user_id
                    // "http://localhost:5002/successful_match/849412270214119425" 
                    // )
                    // .then((response) => response.json())
                    .then(response => {
                        // Getting the successful matches from a user_id
                        this.matchesData = response.data.data;
                        console.log(this.matchesData);
                        console.log("============")
                        // console.log(this.matchesData);
                        //Iterate through the successful matches and push them into the table
                        if (this.matchesData.length > 0){
                            for (var i = 0; i < this.matchesData.length; i++) {
                                this.matchesResult.push(this.matchesData[i]);
                                console.log(this.matchesResult);
                                
                                let matchUser1 = this.matchesData[i]['user_id1'];

                                // Checking for the user_id that is not the current user
                                if (matchUser1 == user_id){
                                    this.matchesInfo[this.matchesData[i]['user_id2']] = {};
                                    this.getUserInfo(this.matchesData[i]['user_id2']);
                                } else{
                                    this.matchesInfo[this.matchesData[i]['user_id1']] = {};
                                    this.getUserInfo(this.matchesData[i]['user_id1']);
                                }
                            }
                        } else{
                            console.log("No matches");
                            this.matchesResult = 0;
                        }
                    })
                    .catch(error => {
                        console.log(error.message)
                    });
                },

                getUserInfo(userId){

                    // Let's get the user's information


                    axios.get()
                    fetch(
                        "http://localhost:26257/user/" + userId.toString(),
                        {
                            mode: 'no-cors',
                        }
                    )
                    .then((response) => response.json())
                    .then((data) =>{
                        console.log(data['data'])
                    })
                }

            },

            mounted() {
                this.getMatches();
                this.getUserInfo();
            },

            computed : {
                
            }
        }
    );

    app.mount("#app"); 

</script>
    
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

</body>
</html>